<%
  resource_labels = {
    "Product" => "Productos",
    "Provider" => "Proveedores",
    "Customer" => "Clientes"
  }
  resource_label = resource_labels[@resource_type] || @resource_type

  resource_paths = {
    "Product" => products_path,
    "Provider" => providers_path,
    "Customer" => customers_path
  }
  cancel_path = resource_paths[@resource_type] || root_path
%>

<% content_for :page_title, "Importar #{resource_label}" %>

<div class="max-w-3xl mx-auto py-8 px-4">
  <div class="mb-8">
    <h1 class="text-2xl font-bold text-foreground">
      Importar <%= resource_label %>
    </h1>
    <p class="mt-1 text-sm text-muted-foreground">
      Carga masiva desde un archivo Excel o CSV.
    </p>
  </div>

  <%# Download template card %>
  <div class="card mb-6">
    <div class="flex items-start gap-4">
      <div class="flex-shrink-0">
        <div class="w-12 h-12 bg-primary/10 rounded-lg flex items-center justify-center">
          <svg class="w-6 h-6 text-primary" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
          </svg>
        </div>
      </div>
      <div class="flex-1">
        <h3 class="text-lg font-medium text-foreground">Paso 1: Descargar plantilla</h3>
        <p class="mt-1 text-sm text-muted-foreground">
          Descarga la plantilla Excel con las columnas correctas y ejemplos de como llenarla.
          Las filas de ejemplo seran ignoradas automaticamente.
        </p>
        <div class="mt-4">
          <%= link_to template_bulk_imports_path(resource_type: @resource_type),
                      class: "btn-secondary inline-flex items-center gap-2",
                      data: { turbo: false } do %>
            <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
              <path stroke-linecap="round" stroke-linejoin="round" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" />
            </svg>
            Descargar Plantilla
          <% end %>
        </div>
      </div>
    </div>
  </div>

  <%# Upload form card %>
  <div class="card">
    <div class="flex items-start gap-4 mb-6">
      <div class="flex-shrink-0">
        <div class="w-12 h-12 bg-primary/10 rounded-lg flex items-center justify-center">
          <svg class="w-6 h-6 text-primary" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12" />
          </svg>
        </div>
      </div>
      <div class="flex-1">
        <h3 class="text-lg font-medium text-foreground">Paso 2: Subir archivo</h3>
        <p class="mt-1 text-sm text-muted-foreground">
          Sube tu archivo Excel (.xlsx) o CSV con los datos a importar.
          Maximo 10MB.
        </p>
      </div>
    </div>

    <%= form_with model: BulkImport.new, url: bulk_imports_path, class: "space-y-6" do |f| %>
      <%= f.hidden_field :resource_type, value: @resource_type %>

      <div data-controller="file-upload">
        <%= f.label :file, "Archivo", class: "form-label" %>
        <div class="mt-1 flex justify-center px-6 pt-5 pb-6 border-2 border-border border-dashed rounded-lg hover:border-primary/50 transition-colors"
             data-file-upload-target="dropzone">
          <div class="space-y-1 text-center">
            <svg class="mx-auto h-12 w-12 text-muted-foreground" stroke="currentColor" fill="none" viewBox="0 0 48 48">
              <path d="M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8m-12 4h.02" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
            </svg>
            <div class="flex text-sm text-muted-foreground justify-center">
              <label class="relative cursor-pointer rounded-md font-medium text-primary hover:text-primary/80 focus-within:outline-none">
                <span>Seleccionar archivo</span>
                <%= f.file_field :file,
                                 accept: ".xlsx,.xls,.csv",
                                 required: true,
                                 class: "sr-only",
                                 data: {
                                   file_upload_target: "input",
                                   action: "change->file-upload#updateFileName"
                                 } %>
              </label>
              <p class="pl-1">o arrastra y suelta</p>
            </div>
            <p class="text-xs text-muted-foreground">Excel o CSV hasta 10MB</p>
            <div class="mt-3" data-file-upload-target="fileName"></div>
          </div>
        </div>
      </div>

      <div class="bg-muted/30 rounded-lg p-4">
        <h4 class="text-sm font-medium text-foreground mb-2">Recuerda:</h4>
        <ul class="text-sm text-muted-foreground space-y-1">
          <li class="flex items-start gap-2">
            <svg class="w-4 h-4 text-primary mt-0.5 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
              <path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7" />
            </svg>
            No es necesario que elimines las filas de ejemplo
          </li>
          <li class="flex items-start gap-2">
            <svg class="w-4 h-4 text-primary mt-0.5 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
              <path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7" />
            </svg>
            Las filas con "prueba" o "test" seran ignoradas automaticamente
          </li>
        </ul>
      </div>

      <div class="flex justify-end gap-3">
        <%= link_to "Cancelar", cancel_path, class: "btn-secondary" %>
        <%= f.submit "Iniciar Importacion", class: "btn-primary cursor-pointer" %>
      </div>
    <% end %>
  </div>

  <%# Import history link %>
  <div class="mt-6 text-center">
    <%= link_to bulk_imports_path(resource_type: @resource_type),
                class: "text-sm text-primary hover:underline" do %>
      Ver historial de importaciones
      <svg class="w-4 h-4 inline-block ml-1" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
        <path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7" />
      </svg>
    <% end %>
  </div>
</div>
