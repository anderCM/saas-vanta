<%= form_with model: product, class: "space-y-8", local: true, data: { controller: "product-form" } do |f| %>
  <% if product.errors.any? %>
    <div class="alert-error">
      <h3 class="text-sm font-medium">Se encontraron errores:</h3>
      <div class="mt-2 text-sm">
        <ul role="list" class="list-disc space-y-1 pl-5">
          <% product.errors.full_messages.each do |msg| %>
            <li><%= msg %></li>
          <% end %>
        </ul>
      </div>
    </div>
  <% end %>

  <%# Informacion basica %>
  <div class="card">
    <h3 class="text-lg font-medium leading-6 text-foreground">Informacion del Producto</h3>
    <div class="mt-6 grid grid-cols-1 gap-y-6 gap-x-4 sm:grid-cols-6">

      <div class="sm:col-span-4">
        <%= f.label :name, "Nombre del Producto", class: "form-label" %>
        <%= f.text_field :name, class: "form-input", required: true %>
      </div>

      <div class="sm:col-span-2">
        <%= f.label :sku, "SKU (Codigo)", class: "form-label" %>
        <%= f.text_field :sku, class: "form-input", placeholder: "Opcional" %>
      </div>

      <div class="sm:col-span-6">
        <%= f.label :description, "Descripcion", class: "form-label" %>
        <%= f.text_area :description, class: "form-input", rows: 3, placeholder: "Descripcion del producto (opcional)" %>
      </div>

      <div class="sm:col-span-2">
        <%= f.label :source_type, "Tipo de Origen", class: "form-label" %>
        <%= f.select :source_type,
            options_for_select([
              ["Comprado", "purchased"],
              ["Manufacturado", "manufactured"],
              ["Otro", "other"]
            ], product.source_type),
            {},
            class: "form-input",
            data: { product_form_target: "sourceType", action: "change->product-form#toggleProvider" } %>
      </div>

      <div class="sm:col-span-2">
        <%= f.label :unit, "Unidad de Medida", class: "form-label" %>
        <%= f.select :unit,
            options_for_select([
              ["Kilogramo (kg)", "kg"],
              ["Gramo (g)", "g"],
              ["Litro (lt)", "lt"],
              ["Mililitro (ml)", "ml"],
              ["Unidad (un)", "un"],
              ["Centilitro (cl)", "cl"]
            ], product.unit || "un"),
            {},
            class: "form-input" %>
      </div>

      <div class="sm:col-span-2">
        <%= f.label :units_per_package, "Unidades por Paquete", class: "form-label" %>
        <%= f.number_field :units_per_package, class: "form-input", min: 1, placeholder: "Opcional" %>
      </div>

      <div class="sm:col-span-3" data-product-form-target="providerContainer">
        <%= f.label :provider_id, "Proveedor", class: "form-label" %>
        <%= f.select :provider_id,
            options_for_select(
              providers.map { |p| [p.name, p.id] },
              product.provider_id
            ),
            { include_blank: "Seleccionar proveedor" },
            class: "form-input" %>
        <p class="mt-1 text-xs text-muted-foreground">Requerido para productos comprados</p>
      </div>

      <div class="sm:col-span-3">
        <%= f.label :status, "Estado", class: "form-label" %>
        <%= f.select :status,
            options_for_select([
              ["Activo", "active"],
              ["Inactivo", "inactive"],
              ["Descontinuado", "discontinued"]
            ], product.status || "active"),
            {},
            class: "form-input" %>
      </div>

    </div>
  </div>

  <%# Precios %>
  <div class="card">
    <h3 class="text-lg font-medium leading-6 text-foreground">Precios</h3>
    <p class="mt-1 text-sm text-muted-foreground">Configura los precios de compra y venta del producto.</p>

    <div class="mt-6 grid grid-cols-1 gap-y-6 gap-x-4 sm:grid-cols-6">

      <div class="sm:col-span-2">
        <%= f.label :buy_price, "Precio de Compra", class: "form-label" %>
        <div class="relative">
          <span class="absolute left-3 top-1/2 -translate-y-1/2 text-muted-foreground text-sm">S/</span>
          <%= f.number_field :buy_price, class: "form-input pl-8", step: 0.01, min: 0, required: true %>
        </div>
      </div>

      <div class="sm:col-span-2">
        <%= f.label :sell_cash_price, "Precio Venta Contado", class: "form-label" %>
        <div class="relative">
          <span class="absolute left-3 top-1/2 -translate-y-1/2 text-muted-foreground text-sm">S/</span>
          <%= f.number_field :sell_cash_price, class: "form-input pl-8", step: 0.01, min: 0, required: true %>
        </div>
      </div>

      <div class="sm:col-span-2">
        <%= f.label :sell_credit_price, "Precio Venta Credito", class: "form-label" %>
        <div class="relative">
          <span class="absolute left-3 top-1/2 -translate-y-1/2 text-muted-foreground text-sm">S/</span>
          <%= f.number_field :sell_credit_price, class: "form-input pl-8", step: 0.01, min: 0, required: true %>
        </div>
      </div>

    </div>
  </div>

  <%# Inventario %>
  <div class="card">
    <h3 class="text-lg font-medium leading-6 text-foreground">Inventario</h3>
    <p class="mt-1 text-sm text-muted-foreground">Opcional - Configura el stock inicial del producto.</p>

    <div class="mt-6 grid grid-cols-1 gap-y-6 gap-x-4 sm:grid-cols-6">

      <div class="sm:col-span-2">
        <%= f.label :stock, "Stock Actual", class: "form-label" %>
        <%= f.number_field :stock, class: "form-input", min: 0, placeholder: "0" %>
      </div>

    </div>
  </div>

  <%# Acciones %>
  <div class="flex justify-end gap-3">
    <%= link_to "Cancelar", products_path, class: "btn-secondary" %>
    <%= f.submit product.persisted? ? "Actualizar Producto" : "Crear Producto", class: "btn-primary cursor-pointer" %>
  </div>
<% end %>
