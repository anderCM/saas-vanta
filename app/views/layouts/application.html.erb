<!DOCTYPE html>
<html>
  <head>
    <title><%= content_for(:title) || "VANTA SAAS" %></title>
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="application-name" content="VANTA SAAS">
    <meta name="mobile-web-app-capable" content="yes">
    <%= csrf_meta_tags %>
    <%= csp_meta_tag %>

    <%= yield :head %>

    <link rel="icon" href="/logo-vanta-fox.png" type="image/png">
    <link rel="apple-touch-icon" href="/logo-vanta-fox.png">

    <%# Google Fonts - Inter %>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <%= stylesheet_link_tag :app, "data-turbo-track": "reload" %>
    <%= javascript_importmap_tags %>
  </head>

  <body class="antialiased">
    <%# Theme initialization - default to light %>
    <script>
      (function() {
        const theme = localStorage.getItem('theme') || 'light';
        if (theme === 'dark') {
          document.body.classList.add('dark');
        }
      })();
    </script>

    <%# Navigation %>
    <nav class="bg-secondary border-b border-border">
      <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">
        <div class="relative flex h-16 items-center justify-between">
          <%# Logo %>
          <div class="flex flex-1 items-center justify-center sm:items-stretch sm:justify-start">
            <div class="flex flex-shrink-0 items-center">
              <img src="/logo-vanta.png" alt="VANTA" class="h-8 w-auto">
            </div>
            <div class="hidden sm:ml-6 sm:block">
              <div class="flex space-x-4">
                <%= link_to "Dashboard", root_path, class: "text-gray-300 hover:bg-gray-700 hover:text-white rounded-md px-3 py-2 text-sm font-medium" %>
                <% if Current.user&.super_admin? %>
                  <%= link_to "Registrar Empresa", new_admin_enterprise_path, class: "text-gray-300 hover:bg-gray-700 hover:text-white rounded-md px-3 py-2 text-sm font-medium" %>
                <% end %>
              </div>
            </div>
          </div>

          <%# Right side %>
          <div class="flex items-center gap-4">
            <%# Theme Toggle %>
            <button
              id="theme-toggle"
              class="p-2 rounded-lg bg-gray-700 text-gray-300 hover:bg-gray-600 transition-colors"
              aria-label="Cambiar tema"
            >
              <svg id="sun-icon" class="hidden w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z" />
              </svg>
              <svg id="moon-icon" class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z" />
              </svg>
            </button>

            <% if authenticated? %>
              <span class="text-gray-300 text-sm hidden sm:block">Hola, <%= Current.user.first_name %></span>
              <%= button_to "Cerrar Sesión", session_path, method: :delete, class: "text-gray-300 hover:bg-red-600 hover:text-white rounded-md px-3 py-2 text-sm font-medium transition-colors" %>
            <% else %>
              <%= link_to "Iniciar Sesión", login_path, class: "btn-primary text-sm" %>
            <% end %>
          </div>
        </div>
      </div>
    </nav>

    <%# Main Content %>
    <main class="min-h-screen bg-background">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <%# Flash Messages %>
        <% flash.each do |key, value| %>
          <div class="<%= key == 'notice' ? 'alert-success' : 'alert-error' %> mb-6" role="alert">
            <span class="block sm:inline"><%= value %></span>
          </div>
        <% end %>

        <%= yield %>
      </div>
    </main>

    <%# Theme toggle functionality %>
    <script>
      function initTheme() {
        const theme = localStorage.getItem('theme') || 'light';
        if (theme === 'dark') {
          document.body.classList.add('dark');
        } else {
          document.body.classList.remove('dark');
        }
        updateThemeIcons();
      }

      function toggleTheme() {
        const isDark = document.body.classList.contains('dark');
        if (isDark) {
          document.body.classList.remove('dark');
          localStorage.setItem('theme', 'light');
        } else {
          document.body.classList.add('dark');
          localStorage.setItem('theme', 'dark');
        }
        updateThemeIcons();
      }

      function updateThemeIcons() {
        const isDark = document.body.classList.contains('dark');
        const sunIcon = document.getElementById('sun-icon');
        const moonIcon = document.getElementById('moon-icon');

        if (isDark) {
          sunIcon?.classList.remove('hidden');
          moonIcon?.classList.add('hidden');
        } else {
          sunIcon?.classList.add('hidden');
          moonIcon?.classList.remove('hidden');
        }
      }

      document.addEventListener('DOMContentLoaded', () => {
        initTheme();
        document.getElementById('theme-toggle')?.addEventListener('click', toggleTheme);
      });

      initTheme();
    </script>
  </body>
</html>
